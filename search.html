<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>儲位查詢系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --base-font-size: 16px; }
        [v-cloak] { display: none; }
        body { 
            background-color: #f1f5f9; 
            font-family: sans-serif; 
            font-size: var(--base-font-size);
            transition: font-size 0.2s ease;
        }
        .search-input { @apply w-full bg-white p-5 rounded-3xl font-black text-[1.2em] text-slate-700 border-2 border-transparent shadow-xl focus:border-blue-400 outline-none transition-all pl-14; }
        .drug-card { @apply bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mb-4 transition-all active:scale-[0.98]; }
        .font-adjust-btn { @apply w-10 h-10 rounded-full border border-slate-200 bg-white flex items-center justify-center text-slate-600 font-bold active:bg-blue-500 active:text-white transition-all text-sm; }
    </style>
</head>
<body class="p-4 pb-12">
    <div id="app" class="max-w-md mx-auto" v-cloak>
        
        <div class="flex justify-between items-center mb-6">
            <a href="index.html" class="bg-white w-10 h-10 rounded-xl shadow-sm flex items-center justify-center text-slate-500 hover:bg-slate-50">
                <i class="fa-solid fa-house"></i>
            </a>
            <div class="flex items-center gap-2">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">字體調整</span>
                <button @click="adjustFont(-2)" class="font-adjust-btn">A-</button>
                <button @click="adjustFont(2)" class="font-adjust-btn">A+</button>
            </div>
        </div>

        <header class="mb-8">
            <h1 class="text-[1.8em] font-black text-slate-800 tracking-tighter">儲位查詢</h1>
            <p class="text-slate-400 font-bold text-[0.8em] uppercase tracking-widest">Storage Location Search</p>
        </header>

        <div class="relative mb-8">
            <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 text-[1.2em]"></i>
            <input v-model="query" @input="onSearch" placeholder="輸入代碼、藥名或位置..." class="search-input">
            <button v-if="query" @click="query = ''; results = []" class="absolute right-5 top-1/2 -translate-y-1/2 text-slate-300">
                <i class="fa-solid fa-circle-xmark text-[1.2em]"></i>
            </button>
        </div>

        <div v-if="results.length > 0" class="space-y-4">
            <div v-for="item in results" :key="item.c" class="drug-card">
                <div class="flex justify-between items-start mb-3">
                    <span class="text-[0.7em] font-mono font-bold text-blue-500 tracking-widest uppercase bg-blue-50 px-2 py-0.5 rounded">{{ item.c }}</span>
                    <a :href="'transfer.html?code=' + item.c + '&name=' + item.n" class="text-blue-500 text-[0.9em] font-bold flex items-center gap-1">
                        撥補 <i class="fa-solid fa-chevron-right text-[0.8em]"></i>
                    </a>
                </div>
                <h2 class="text-[1.2em] font-black text-slate-800 mb-4 leading-tight">{{ item.n }}</h2>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                        <p class="text-[0.6em] text-slate-400 font-bold uppercase mb-1">儲位位置</p>
                        <p class="text-[1.1em] font-black text-slate-700">{{ item.l || '未標記' }}</p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                        <p class="text-[0.6em] text-slate-400 font-bold uppercase mb-1">規格單位</p>
                        <p class="text-[1.1em] font-black text-slate-700">{{ item.u || '---' }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="query" class="text-center py-20">
            <i class="fa-solid fa-box-open text-slate-200 text-5xl mb-4"></i>
            <p class="text-slate-400 font-bold">找不到相關藥品</p>
        </div>

        <footer class="mt-12 text-center opacity-50">
            <p class="text-[10px] text-slate-400 font-mono">v1.6.20260106</p>
        </footer>
    </div>

    <script type="module">
        import { createApp, ref, onMounted } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref as dbRef, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZuNztwb9aLG1RqeDOyrj6KJrPhwBFi9M",
            authDomain: "fyh-pharmacy-inventory.firebaseapp.com",
            databaseURL: "https://fyh-pharmacy-inventory-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fyh-pharmacy-inventory",
            storageBucket: "fyh-pharmacy-inventory.firebasestorage.app",
            messagingSenderId: "751378148626",
            appId: "1:751378148626:web:5a2d2be1c5f905657457cb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        createApp({
            setup() {
                const query = ref('');
                const warehouse = ref([]);
                const results = ref([]);
                const fontSize = ref(16);

                onMounted(() => {
                    // 讀取字體大小設定
                    const savedSize = localStorage.getItem('fyh-font-size');
                    if (savedSize) {
                        fontSize.value = parseInt(savedSize);
                        document.documentElement.style.setProperty('--base-font-size', `${fontSize.value}px`);
                    }

                    // 讀取藥庫資料
                    onValue(dbRef(db, "warehouse"), (snapshot) => {
                        const data = snapshot.val();
                        warehouse.value = data ? Object.values(data) : [];
                    });
                });

                const adjustFont = (delta) => {
                    fontSize.value += delta;
                    if (fontSize.value < 12) fontSize.value = 12;
                    if (fontSize.value > 32) fontSize.value = 32;
                    document.documentElement.style.setProperty('--base-font-size', `${fontSize.value}px`);
                    localStorage.setItem('fyh-font-size', fontSize.value);
                };

                const onSearch = () => {
                    const k = query.value.trim().toLowerCase();
                    if (!k) { results.value = []; return; }
                    results.value = warehouse.value.filter(i => 
                        (i.n?.toLowerCase().includes(k) || 
                         i.c?.toLowerCase().includes(k) || 
                         i.l?.toLowerCase().includes(k))
                    ).slice(0, 20);
                };

                return { query, results, onSearch, fontSize, adjustFont };
            }
        }).mount('#app');
    </script>
</body>
</html>
