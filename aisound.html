<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è—¥è¢‹èªéŸ³åŠ©æ‰‹ - è±åŸé†«é™¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --med-teal: #00796b; --med-dark: #004d40; }
        body { background-color: #f1f3f4; font-family: "PingFang TC", sans-serif; }
        .app-header { background: var(--med-teal); color: white; padding: 15px; }
        
        #scanner-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1 / 1;
            margin: 15px auto;
            border: 4px solid white;
            border-radius: 20px;
            overflow: hidden;
            background: #000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #reader { width: 100%; height: 100%; }

        .lang-selector {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 10px 15px;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-top: 5px solid var(--med-teal);
        }
        
        .label { color: #666; font-size: 0.9rem; margin-bottom: 5px; }
        .value { color: var(--med-dark); font-weight: bold; font-size: 1.4rem; line-height: 1.2; }
        
        #start-btn {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 100; padding: 12px 25px; border-radius: 50px;
        }
    </style>
</head>
<body>

<div class="app-header text-center">
    <h5 class="mb-0">è—¥è¢‹èªéŸ³è¼”åŠ©ç³»çµ± (è±åŸé†«é™¢)</h5>
</div>

<div class="lang-selector">
    <label class="label">è«‹é¸æ“‡èªéŸ³èªè¨€ (Select Language):</label>
    <select id="langSelect" class="form-select form-select-lg">
        <option value="zh-TW" selected>ä¸­æ–‡ (ç¹é«”)</option>
        <option value="en-US">English (è‹±æ–‡)</option>
        <option value="id-ID">Bahasa Indonesia (å°å°¼æ–‡)</option>
        <option value="vi-VN">Tiáº¿ng Viá»‡t (è¶Šå—æ–‡)</option>
        <option value="th-TH">à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ (æ³°æ–‡)</option>
        <option value="fil-PH">Filipino (è²å¾‹è³“æ–‡)</option>
        <option value="nan-TW">å°èª (éœ€è£ç½®æ”¯æ´)</option>
    </select>
</div>

<div id="scanner-wrapper">
    <div id="reader"></div>
    <button id="start-btn" class="btn btn-primary shadow" onclick="startScanner()">é–‹å•Ÿç›¸æ©Ÿæƒæ</button>
</div>

<div id="resultCard" class="result-card">
    <div class="row">
        <div class="col-12 mb-3">
            <div class="label">æœç”¨é€”å¾‘ (Route)</div>
            <div id="res-route" class="value">-</div>
        </div>
        <div class="col-12">
            <div class="label">æœç”¨æ™‚é–“èˆ‡é »æ¬¡ (Frequency)</div>
            <div id="res-freq" class="value">-</div>
        </div>
    </div>
    <button class="btn btn-outline-secondary w-100 mt-4" onclick="replayAudio()">ğŸ”Š é‡æ–°æœ—è®€ / Replay</button>
</div>

<script>
    // å¤šåœ‹èªè¨€ç¿»è­¯å­—å…¸
    const translations = {
        'zh-TW': {
            'QDPC': 'æ¯æ—¥ä¸€æ¬¡ï¼Œé£¯å¾Œæœç”¨', 'BID': 'æ¯æ—¥äºŒæ¬¡', 'TID': 'æ¯æ—¥ä¸‰æ¬¡', 'HS': 'ç¡å‰æœç”¨',
            'PO': 'å£æœ', 'EXT': 'å¤–ç”¨', 'welcome': 'æ‚¨å¥½ï¼Œé€™å€‹è—¥ï¼š', 'use': 'æ–¹å¼æ˜¯'
        },
        'en-US': {
            'QDPC': 'Once daily after meals', 'BID': 'Twice daily', 'TID': 'Three times daily', 'HS': 'Before bed',
            'PO': 'Oral', 'EXT': 'External use', 'welcome': 'Hello, this medicine: ', 'use': 'Take it by '
        },
        'id-ID': {
            'QDPC': 'Sekali sehari setelah makan', 'BID': 'Dua kali sehari', 'TID': 'Tiga kali sehari', 'HS': 'Sebelum tidur',
            'PO': 'Diminum', 'EXT': 'Obat luar', 'welcome': 'Halo, obat ini: ', 'use': 'Cara pakainya '
        },
        'vi-VN': {
            'QDPC': 'Má»—i ngÃ y má»™t láº§n sau khi Äƒn', 'BID': 'Má»—i ngÃ y hai láº§n', 'TID': 'Má»—i ngÃ y ba láº§n', 'HS': 'TrÆ°á»›c khi Ä‘i ngá»§',
            'PO': 'ÄÆ°á»ng uá»‘ng', 'EXT': 'DÃ¹ng ngoÃ i da', 'welcome': 'Xin chÃ o, thuá»‘c nÃ y: ', 'use': 'CÃ¡ch dÃ¹ng lÃ  '
        },
        'th-TH': {
            'QDPC': 'à¸§à¸±à¸™à¸¥à¸°à¸«à¸™à¸¶à¹ˆà¸‡à¸„à¸£à¸±à¹‰à¸‡ à¸«à¸¥à¸±à¸‡à¸­à¸²à¸«à¸²à¸£', 'BID': 'à¸§à¸±à¸™à¸¥à¸°à¸ªà¸­à¸‡à¸„à¸£à¸±à¹‰à¸‡', 'TID': 'à¸§à¸±à¸™à¸¥à¸°à¸ªà¸²à¸¡à¸„à¸£à¸±à¹‰à¸‡', 'HS': 'à¸à¹ˆà¸­à¸™à¸™à¸­à¸™',
            'PO': 'à¸£à¸±à¸šà¸›à¸£à¸°à¸—à¸²à¸™', 'EXT': 'à¹ƒà¸Šà¹‰à¸ à¸²à¸¢à¸™à¸­à¸', 'welcome': 'à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¹ˆà¸° à¸¢à¸²à¸•à¸±à¸§à¸™à¸µà¹‰: ', 'use': 'à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¸„à¸·à¸­ '
        },
        'fil-PH': {
            'QDPC': 'Isang beses sa isang araw pagkatapos kumain', 'BID': 'Dalawang beses sa isang araw', 'TID': 'Tatlong beses sa isang araw', 'HS': 'Bago matulog',
            'PO': 'Iniinom', 'EXT': 'Pang-labas na gamit', 'welcome': 'Hello, ang gamot na ito: ', 'use': 'Ang paraan ay '
        },
        'nan-TW': { // å°èªç¿»è­¯å»ºè­°
            'QDPC': 'é€å·¥ä¸€æ”¹ï¼Œé£Ÿé£½æ‰é£Ÿ', 'BID': 'é€å·¥å…©æ”¹', 'TID': 'é€å·¥ä¸‰æ”¹', 'HS': 'æ¬²æ„›çå‰é£Ÿ',
            'PO': 'é£Ÿè½å»çš„', 'EXT': 'å¤–æ•·çš„', 'welcome': 'ä½ å¥½ï¼Œé€™æ¬¾è—¥ä»”ï¼š', 'use': 'é£Ÿæ³•æ˜¯'
        }
    };

    let html5QrCode;
    let lastText = "";
    let speechMessage = "";

    function startScanner() {
        document.getElementById('start-btn').style.display = 'none';
        html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start({ facingMode: "environment" }, { fps: 20, qrbox: 250 }, onScanSuccess);
        // é ç†±èªéŸ³
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(""));
    }

    function onScanSuccess(decodedText) {
        if (decodedText === lastText) return;
        const parts = decodedText.split(';');
        if (parts.length >= 6) {
            lastText = decodedText;
            const lang = document.getElementById('langSelect').value;
            const dict = translations[lang] || translations['zh-TW'];

            const freqCode = parts[4];
            const routeCode = parts[5];

            const freqText = dict[freqCode] || freqCode;
            const routeText = dict[routeCode] || routeCode;

            document.getElementById('res-freq').innerText = freqText;
            document.getElementById('res-route').innerText = routeText;
            document.getElementById('resultCard').style.display = 'block';

            speechMessage = `${dict['welcome']} ${freqText}ã€‚ ${dict['use']} ${routeText}ã€‚`;
            speak(speechMessage, lang);

            setTimeout(() => { lastText = ""; }, 5000);
        }
    }

    function speak(text, lang) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.85;

        // å˜—è©¦è‡ªå‹•åŒ¹é…è©²èªè¨€çš„æœ€ä½³èªéŸ³
        const voices = window.speechSynthesis.getVoices();
        const bestVoice = voices.find(v => v.lang.startsWith(lang.split('-')[0]));
        if (bestVoice) utterance.voice = bestVoice;

        window.speechSynthesis.speak(utterance);
    }

    function replayAudio() {
        if (speechMessage) speak(speechMessage, document.getElementById('langSelect').value);
    }
</script>
</body>
</html>
