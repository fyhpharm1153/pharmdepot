<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114Q4 è—¥å“é€²åº¦è¿½è¹¤</title>
    <style>
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        th { background-color: #f8f9fa; color: #5f6368; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; word-wrap: break-word; font-size: 14px; }
        
        tr:hover { background-color: #fdfdfd; }
        
        .badge { padding: 4px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; display: inline-block; white-space: nowrap; }
        .bg-success { background-color: #e6f4ea; color: #1e7e34; } 
        .bg-warning { background-color: #fef7e0; color: #b05a00; } 
        .bg-danger { background-color: #fce8e6; color: #d93025; }  
        .bg-default { background-color: #f1f3f4; color: #70757a; } 

        .note-text { color: #666; font-size: 13px; line-height: 1.4; }
        .loading { text-align: center; padding: 50px; font-size: 18px; color: #1a73e8; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“‹ 114Q4 è—¥å“æ¡è³¼èˆ‡å»ºæª”é€²åº¦çœ‹æ¿</h2>
    <div id="status-container">
        <div id="loading" class="loading">ğŸ“¡ æ­£åœ¨åŒæ­¥ Google Sheets è³‡æ–™...</div>
        <table id="data-table" style="display:none;">
            <thead>
                <tr>
                    <th style="width: 25%;">è—¥å“åç¨± (H)</th>
                    <th style="width: 12%;">æ¡è³¼é€²åº¦ (S)</th>
                    <th style="width: 12%;">HIS å»ºæª” (T)</th>
                    <th style="width: 12%;">é–‹/é—œæª” (U)</th>
                    <th style="width: 39%;">å‚™è¨» (L)</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQVAyi3_RHMvbMH91EKHlNIMF6cMvgPjw-29OczSJnJjyNT6FeOAusRSPTn7UH17I8VJUD9cBydhcJr/pub?output=csv&gid=283594106";

    async function fetchData() {
        try {
            const response = await fetch(csvUrl);
            const csvText = await response.text();
            
            // è§£æ CSV è¡Œ
            const rows = csvText.split('\n').map(row => {
                // è™•ç†å¯èƒ½åŒ…å«é€—è™Ÿçš„å„²å­˜æ ¼å…§å®¹ (CSV åŸºæœ¬è™•ç†)
                return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            });
            
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = ''; 

            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row[7] || row[7].trim() === "") continue; 

                const name = row[7].replace(/"/g, "").trim();      // H æ¬„
                const note = row[11] ? row[11].replace(/"/g, "").trim() : ''; // L æ¬„ (å‚™è¨»)
                const progress = row[18] ? row[18].trim() : '---'; // S æ¬„
                const his = row[19] ? row[19].trim() : '---';      // T æ¬„
                const status = row[20] ? row[20].trim() : '---';   // U æ¬„

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${name}</strong></td>
                    <td>${renderBadge(progress)}</td>
                    <td>${renderBadge(his)}</td>
                    <td>${renderBadge(status)}</td>
                    <td class="note-text">${note}</td>
                `;
                tableBody.appendChild(tr);
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('data-table').style.display = 'table';

        } catch (error) {
            document.getElementById('loading').innerHTML = "âŒ ç„¡æ³•è®€å–è³‡æ–™ï¼Œè«‹ç¢ºèª Google Sheet å·²ã€Œç™¼ä½ˆåˆ°ç¶²è·¯ã€ã€‚";
        }
    }

    function renderBadge(text) {
        text = text.replace(/"/g, ""); // ç§»é™¤ CSV å¯èƒ½å¸¶æœ‰çš„å¼•è™Ÿ
        if (!text || text === '---' || text === "") return `<span class="badge bg-default">å¾…å®š</span>`;
        
        let colorClass = "bg-default";
        if (text.includes("å®Œæˆ") || text.includes("å·²") || text.includes("é–‹æª”") || text.includes("OK")) {
            colorClass = "bg-success";
        } else if (text.includes("é€²ä¸­") || text.includes("è¾¦ç†") || text.includes("å¾…") || text.includes("ç°½æ ¸")) {
            colorClass = "bg-warning";
        } else if (text.includes("é—œæª”") || text.includes("åœ") || text.includes("ä¸")) {
            colorClass = "bg-danger";
        }
        
        return `<span class="badge ${colorClass}">${text}</span>`;
    }

    fetchData();
</script>

</body>
</html>
