<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114Q4 è—¥å“é€²åº¦è¿½è¹¤ç³»çµ±</title>
    <style>
        :root { --base-font-size: 16px; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: #f4f7f9; padding: 10px; color: #333; font-size: var(--base-font-size); }
        .container { max-width: 1400px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* å·¥å…·åˆ— */
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .btn { padding: 8px 12px; cursor: pointer; border: 1px solid #dcdfe6; border-radius: 6px; font-weight: bold; background: #fff; color: #606266; text-decoration: none; display: inline-flex; align-items: center; font-size: 14px; }
        .btn:hover { background: #1a73e8; color: white; border-color: #1a73e8; }
        
        .search-box { flex-grow: 1; min-width: 250px; }
        .search-box input { width: 100%; padding: 10px; border: 1px solid #dcdfe6; border-radius: 6px; outline: none; box-sizing: border-box; }

        h2 { text-align: center; color: #1a73e8; margin: 0; flex-basis: 100%; padding-bottom: 10px; font-size: 1.5em; }
        
        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; table-layout: fixed; margin-top: 10px; }
        th { background-color: #f8f9fa; color: #5f6368; padding: 12px; border-bottom: 2px solid #dee2e6; text-align: left; font-size: 0.9em; }
        td { padding: 15px 12px; border-bottom: 1px solid #eee; vertical-align: middle; word-wrap: break-word; }
        tr:hover { background-color: #f9fbff; }

        /* è—¥å“è³‡è¨Šæ’ç‰ˆ */
        .drug-name { font-weight: bold; color: #1a2a3a; display: block; margin-bottom: 4px; font-size: 1.1em; line-height: 1.2; }
        .drug-ingredient { font-size: 0.85em; color: #0056b3; display: block; }
        .drug-spec { font-size: 0.8em; color: #666; display: block; }
        
        /* ç‹€æ…‹æ¨™ç±¤æ¨£å¼ */
        .badge { padding: 6px 10px; border-radius: 6px; font-size: 0.9em; font-weight: bold; display: inline-block; text-align: center; width: 90%; }
        .status-ready { background-color: #e6f4ea; color: #1e7e34; } /* ç¶ è‰² */
        .status-warn { background-color: #fef7e0; color: #b05a00; }  /* é»ƒè‰² */
        .status-stop { background-color: #fce8e6; color: #d93025; }  /* ç´…è‰² */
        .status-none { background-color: #f1f3f4; color: #70757a; }  /* ç°è‰² */

        /* å„²ä½å°ˆç”¨æ¨£å¼ */
        .loc-badge { padding: 4px 8px; border-radius: 4px; font-family: monospace; font-weight: bold; font-size: 0.95em; }

        .loading { text-align: center; padding: 50px; font-size: 1.2em; color: #1a73e8; }

        /* RWD æ‰‹æ©Ÿç‰ˆ */
        @media screen and (max-width: 850px) {
            thead { display: none; }
            tr { display: block; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
            td { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; border-bottom: 1px dashed #eee; width: 100% !important; box-sizing: border-box; }
            td:last-child { border-bottom: none; flex-direction: column; align-items: flex-start; text-align: left; }
            td::before { content: attr(data-label); font-weight: bold; color: #888; font-size: 0.85em; margin-right: 10px; flex-shrink: 0; }
            td:first-child { flex-direction: column; align-items: flex-start; }
            td:first-child::before { display: none; }
            .badge { width: auto; min-width: 100px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="toolbar">
        <h2>ğŸ’Š 114Q4 è—¥å“æ¡è³¼é€²åº¦çœ‹æ¿</h2>
        <a href="https://fyhpharm1153.github.io/pharmdepot/index.html" class="btn">ğŸ  å›é¦–é </a>

        <div class="search-box">
            <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="ğŸ” æœå°‹è—¥åã€æˆåˆ†ã€è¦æ ¼æˆ–å„²ä½...">
        </div>

        <div class="font-controls">
            <button class="btn" onclick="changeFontSize(2)">A+</button>
            <button class="btn" onclick="changeFontSize(-2)">A-</button>
        </div>
    </div>

    <div id="loading" class="loading">ğŸ“¡ æ­£åœ¨åŒæ­¥è³‡æ–™åº«...</div>
    
    <table id="data-table" style="display:none;">
        <thead>
            <tr>
                <th style="width: 28%;">è—¥å / æˆåˆ† / è¦æ ¼</th>
                <th style="width: 11%;">æ¡è³¼é€²åº¦</th>
                <th style="width: 11%;">HISå»ºæª”</th>
                <th style="width: 11%;">é–‹/é—œæª”</th>
                <th style="width: 12%;">å„²ä½</th>
                <th style="width: 27%;">å‚™è¨»</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQVAyi3_RHMvbMH91EKHlNIMF6cMvgPjw-29OczSJnJjyNT6FeOAusRSPTn7UH17I8VJUD9cBydhcJr/pub?output=csv&gid=283594106";

    let currentFontSize = 16;
    function changeFontSize(delta) {
        currentFontSize = Math.min(Math.max(currentFontSize + delta, 12), 30);
        document.documentElement.style.setProperty('--base-font-size', currentFontSize + 'px');
    }

    function filterTable() {
        const filter = document.getElementById("searchInput").value.toUpperCase();
        const tr = document.getElementById("table-body").getElementsByTagName("tr");
        for (let i = 0; i < tr.length; i++) {
            const text = tr[i].innerText || tr[i].textContent;
            tr[i].style.display = text.toUpperCase().indexOf(filter) > -1 ? "" : "none";
        }
    }

    // é€šç”¨ç‹€æ…‹é¡è‰²åˆ¤æ–·
    function getStatusClass(text) {
        if (!text || text.trim() === "" || text === "---") return "status-none";
        const t = text.trim();
        if (t.includes("é–‹æª”") || t.includes("å®Œæˆ") || t.includes("OK") || t.includes("å·²é–‹")) return "status-ready";
        if (t.includes("é—œæª”") || t.includes("é€²ä¸­") || t.includes("è¾¦") || t.includes("å¾…") || t.includes("å·²é—œ")) return "status-warn";
        if (t.includes("åœ") || t.includes("é€€") || t.includes("ä¸")) return "status-stop";
        return "status-none";
    }

    // å„²ä½å°ˆç”¨é¡è‰²åˆ¤æ–·
    function getLocationStyle(text) {
        if (!text || text.trim() === "" || text === "---") return "status-none";
        const t = text.trim();
        if (t.includes("æœªä¸Šæ¶")) return "status-stop"; // ç´…è‰²
        return "status-ready"; // å…¶ä»–ç‹€æ³å‡ç‚ºç¶ è‰²
    }

    async function fetchData() {
        try {
            const response = await fetch(csvUrl);
            const csvText = await response.text();
            const lines = csvText.split(/\r?\n/);
            const tableBody = document.getElementById('table-body');
            
            lines.forEach((line, index) => {
                const row = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const name = row[7] ? row[7].replace(/"/g, "").trim() : "";
                
                if (!name || name === "è—¥å" || name === "å•†å“å" || name.length < 2 || /^\d+$/.test(name)) return;

                const ingredient = row[9] ? row[9].replace(/"/g, "").trim() : "";
                const spec = row[10] ? row[10].replace(/"/g, "").trim() : "";
                const note = row[11] ? row[11].replace(/"/g, "").trim() : ""; 
                const s_val = (row[18] || "").replace(/"/g, "").trim();
                const t_val = (row[19] || "").replace(/"/g, "").trim();
                const u_val = (row[20] || "").replace(/"/g, "").trim();
                const location = row[24] ? row[24].replace(/"/g, "").trim() : "---";

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="è—¥å“è³‡è¨Š">
                        <span class="drug-name">${name}</span>
                        <span class="drug-ingredient">æˆåˆ†ï¼š${ingredient}</span>
                        <span class="drug-spec">è¦æ ¼ï¼š${spec}</span>
                    </td>
                    <td data-label="æ¡è³¼é€²åº¦"><span class="badge ${getStatusClass(s_val)}">${s_val || 'å¾…å®š'}</span></td>
                    <td data-label="HISå»ºæª”"><span class="badge ${getStatusClass(t_val)}">${t_val || 'å¾…å®š'}</span></td>
                    <td data-label="é–‹/é—œæª”"><span class="badge ${getStatusClass(u_val)}">${u_val || 'å¾…å®š'}</span></td>
                    <td data-label="å„²ä½">
                        <span class="badge loc-badge ${getLocationStyle(location)}">${location}</span>
                    </td>
                    <td data-label="å‚™è¨»">${note}</td>
                `;
                tableBody.appendChild(tr);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('data-table').style.display = 'table';
        } catch (e) {
            document.getElementById('loading').innerText = "âŒ è®€å–å¤±æ•—ã€‚";
        }
    }
    fetchData();
</script>

</body>
</html>
